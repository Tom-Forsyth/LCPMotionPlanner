\hypertarget{_physics_scene_8cpp_source}{}\doxysection{Physics\+Scene.\+cpp}
\label{_physics_scene_8cpp_source}\index{src/PhysicsScene.cpp@{src/PhysicsScene.cpp}}
\mbox{\hyperlink{_physics_scene_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_physics_scene_8h}{PhysicsScene.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00002}00002 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_contact_report_filter_shader_8h}{ContactReportFilterShader.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00003}00003 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_contact_report_callback_8h}{ContactReportCallback.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00004}00004 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_shape_8h}{Shape.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00005}00005 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_phys_x_helper_functions_8h}{PhysXHelperFunctions.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00006}00006 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_object_type_8h}{ObjectType.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00007}00007 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_rigid_body_8h}{RigidBody.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00008}00008 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_collision_aggregate_8h}{CollisionAggregate.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00009}00009 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_contact_manager_8h}{ContactManager.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00010}00010 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_contact_point_8h}{ContactPoint.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00011}00011 \textcolor{preprocessor}{\#include "{}PxPhysicsAPI.h"{}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00012}00012 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00013}00013 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00014}00014 \textcolor{preprocessor}{\#include <exception>}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00015}00015 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00016}00016 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00018}00018 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_motion_planner}{MotionPlanner}}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00019}00019 \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00020}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a2bd2b6668ea0b9e2ddb625693e1c3e83}{00020}}     \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a2bd2b6668ea0b9e2ddb625693e1c3e83}{PhysicsScene::PhysicsScene}}(\textcolor{keyword}{const} std::string\& sceneName, physx::PxPhysics* physics, physx::PxCpuDispatcher* cpuDispatcher)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00021}00021         : m\_name(sceneName), m\_physics(physics)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00022}00022     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00023}00023         \textcolor{comment}{// Assign simulation event callback.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00024}00024         m\_simulationEventCallback = \textcolor{keyword}{new} \mbox{\hyperlink{class_motion_planner_1_1_contact_report_callback}{ContactReportCallback}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00026}00026         \textcolor{comment}{// Create scene description.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00027}00027         physx::PxSceneDesc sceneDesc(m\_physics-\/>getTolerancesScale());}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00028}00028         sceneDesc.cpuDispatcher = cpuDispatcher;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00029}00029         sceneDesc.filterShader = \mbox{\hyperlink{namespace_motion_planner_ad4ae6712ddc24ddce9c909462c03b27f}{contactReportFilterShader}};}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00030}00030         sceneDesc.simulationEventCallback = m\_simulationEventCallback;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00032}00032         \textcolor{comment}{// Choose collision filtering mode.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00033}00033 \textcolor{preprocessor}{\#if PX\_PHYSICS\_VERSION\_MAJOR >= 4}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00034}00034         sceneDesc.kineKineFilteringMode = physx::PxPairFilteringMode::eKEEP;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00035}00035         sceneDesc.staticKineFilteringMode = physx::PxPairFilteringMode::eKEEP;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00036}00036 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00037}00037         sceneDesc.flags = physx::PxSceneFlag::eENABLE\_KINEMATIC\_PAIRS | physx::PxSceneFlag::eENABLE\_KINEMATIC\_STATIC\_PAIRS;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00038}00038 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00040}00040         \textcolor{comment}{// Enable PCM collision and create scene.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00041}00041         sceneDesc.flags |= physx::PxSceneFlag::eENABLE\_PCM;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00042}00042         m\_scene = m\_physics-\/>createScene(sceneDesc);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00044}00044         \textcolor{comment}{// Add scene to PVD.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00045}00045         physx::PxPvdSceneClient* pvdClient = m\_scene-\/>getScenePvdClient();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00046}00046         \textcolor{keywordflow}{if} (pvdClient)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00047}00047         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00048}00048             pvdClient-\/>setScenePvdFlag(physx::PxPvdSceneFlag::eTRANSMIT\_CONTACTS, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00049}00049         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00051}00051         \textcolor{comment}{// Setup default material.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00052}00052         m\_material = m\_physics-\/>createMaterial(0.0f, 0.0f, 0.0f);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00054}00054         \textcolor{comment}{// Link the PhysicsScene to the PhysXScene.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00055}00055         \textcolor{keywordtype}{void}* physicsScenePointer = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00056}00056         m\_scene-\/>userData = physicsScenePointer;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00057}00057     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00059}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ae40a78c4ad18c815dd2752c548adee90}{00059}}     \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ae40a78c4ad18c815dd2752c548adee90}{PhysicsScene::\string~PhysicsScene}}()}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00060}00060     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00061}00061         \textcolor{keyword}{delete} m\_simulationEventCallback;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00062}00062     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00064}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a4d84756c621d3ed5dc039685a4b45e60}{00064}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a4d84756c621d3ed5dc039685a4b45e60}{PhysicsScene::connectToPVD}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00065}00065 \textcolor{keyword}{    }\{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00066}00066         physx::PxPvdSceneClient* pvdClient = m\_scene-\/>getScenePvdClient();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00067}00067         \textcolor{keywordflow}{if} (pvdClient)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00068}00068         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00069}00069             pvdClient-\/>setScenePvdFlag(physx::PxPvdSceneFlag::eTRANSMIT\_CONTACTS, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00070}00070         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00071}00071     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00073}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a505e5f84b92c7dd8c0c955f476842b6e}{00073}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a505e5f84b92c7dd8c0c955f476842b6e}{PhysicsScene::addObstacle}}(\textcolor{keyword}{const} \mbox{\hyperlink{class_motion_planner_1_1_shape}{Shape}}\& shape)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00074}00074     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00075}00075         \textcolor{keywordflow}{if} (shape.\mbox{\hyperlink{class_motion_planner_1_1_shape_a1d7f6dd9ae3bc640b2e36384bfb33a13}{getObjectType}}() == \mbox{\hyperlink{namespace_motion_planner_a389521f6122ca955f3e5f2f48487ace3afe29c1262b319e6d200d32384ae636c7}{ObjectType::Obstacle}})}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00076}00076         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00077}00077             \textcolor{comment}{// Get PxTransform.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00078}00078             \textcolor{keyword}{const} Eigen::Matrix4d eigenTransform = shape.\mbox{\hyperlink{class_motion_planner_1_1_shape_a3b70c302b3b3171e9162a495c6722842}{getTransform}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00079}00079             \textcolor{keyword}{const} physx::PxTransform transform = \mbox{\hyperlink{namespace_motion_planner_a838cea8f45278eb0326d5c7e528ac2f2}{eigenMatrixToPxTransform}}(eigenTransform);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00081}00081             \textcolor{comment}{// Create RigidStatic actor of the obstacle.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00082}00082             physx::PxRigidStatic* actor = m\_physics-\/>createRigidStatic(transform);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00084}00084             \textcolor{comment}{// Create a PxShape from the CollisionAvoidance::Shape.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00085}00085             \textcolor{keyword}{const} std::unique\_ptr<physx::PxGeometry> pxGeomPtr = \mbox{\hyperlink{namespace_motion_planner_a9f065fef79f13d23e7c084691a30a62e}{getPxGeometry}}(shape);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00086}00086             \textcolor{keyword}{const} physx::PxGeometry\& pxGeom = *(pxGeomPtr.get());}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00087}00087             physx::PxShape* pxShape = m\_physics-\/>createShape(pxGeom, *m\_material, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00089}00089             \textcolor{comment}{// Set the object type as an obstacle for collision filtering.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00090}00090             physx::PxFilterData filterData;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00091}00091             filterData.word0 = \textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(\mbox{\hyperlink{namespace_motion_planner_a389521f6122ca955f3e5f2f48487ace3afe29c1262b319e6d200d32384ae636c7}{ObjectType::Obstacle}});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00092}00092             pxShape-\/>setSimulationFilterData(filterData);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00093}00093 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00094}00094             \textcolor{comment}{// Set the shape and actor name.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00095}00095             \textcolor{keyword}{const} std::string shapeName = shape.\mbox{\hyperlink{class_motion_planner_1_1_shape_aa3c8b0855477f802a4dd0f3c70fae83f}{getName}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00096}00096             \textcolor{keyword}{const} \textcolor{keywordtype}{char}* shapeNameChar = shapeName.c\_str();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00097}00097             actor-\/>setName(shapeNameChar);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00098}00098             pxShape-\/>setName(shapeNameChar);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00100}00100             \textcolor{comment}{// Store pointer to the original shape in the PxShape and PxActor.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00101}00101             \textcolor{comment}{// Note that we must use const\_cast here since the PhysX API only accepts a non-\/const void*.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00102}00102             \textcolor{comment}{// My internal use of the shape is read only so there is no concern.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00103}00103             \textcolor{keyword}{const} \textcolor{keywordtype}{void}* shapePointerConst = \&shape;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00104}00104             \textcolor{keywordtype}{void}* shapePointer = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(shapePointerConst);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00105}00105             actor-\/>userData = shapePointer;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00106}00106             pxShape-\/>userData = shapePointer;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00108}00108             \textcolor{comment}{// Attach the shape to the actor and release.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00109}00109             actor-\/>attachShape(*pxShape);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00110}00110             pxShape-\/>release();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00112}00112             \textcolor{comment}{// Add the new actor to scene.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00113}00113             m\_obstacleActors.emplace(shapeName, actor);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00114}00114             m\_scene-\/>addActor(*actor);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00115}00115         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00116}00116         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00117}00117         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00118}00118             \textcolor{keywordflow}{throw} std::invalid\_argument(\textcolor{stringliteral}{"{}Shape must be an obstacle."{}});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00119}00119         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00120}00120     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00121}00121 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00122}00122     \textcolor{keywordtype}{void} PhysicsScene::addCollider(\textcolor{keyword}{const} \mbox{\hyperlink{class_motion_planner_1_1_shape}{Shape}}\& shape)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00123}00123     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00124}00124         \textcolor{keywordflow}{if} (shape.\mbox{\hyperlink{class_motion_planner_1_1_shape_a1d7f6dd9ae3bc640b2e36384bfb33a13}{getObjectType}}() == \mbox{\hyperlink{namespace_motion_planner_a389521f6122ca955f3e5f2f48487ace3a4a8d617c440e9ede7d3092416327a525}{ObjectType::RobotGeometry}})}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00125}00125         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00126}00126             \textcolor{comment}{// Get PxTransform.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00127}00127             \textcolor{keyword}{const} Eigen::Matrix4d eigenTransform = shape.\mbox{\hyperlink{class_motion_planner_1_1_shape_a3b70c302b3b3171e9162a495c6722842}{getTransform}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00128}00128             \textcolor{keyword}{const} physx::PxTransform transform = \mbox{\hyperlink{namespace_motion_planner_a838cea8f45278eb0326d5c7e528ac2f2}{eigenMatrixToPxTransform}}(eigenTransform);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00130}00130             \textcolor{comment}{// Create RigidDynamic kinematic actor.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00131}00131             physx::PxRigidDynamic* actor = m\_physics-\/>createRigidDynamic(transform);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00132}00132             actor-\/>setRigidBodyFlag(physx::PxRigidBodyFlag::eKINEMATIC, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00134}00134             \textcolor{comment}{// Create a PxShape from the CollisionAvoidance::Shape.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00135}00135             \textcolor{keyword}{const} std::unique\_ptr<physx::PxGeometry> pxGeomPtr = \mbox{\hyperlink{namespace_motion_planner_a9f065fef79f13d23e7c084691a30a62e}{getPxGeometry}}(shape);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00136}00136             \textcolor{keyword}{const} physx::PxGeometry\& pxGeom = *(pxGeomPtr.get());}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00137}00137             physx::PxShape* pxShape = m\_physics-\/>createShape(pxGeom, *m\_material, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00138}00138 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00139}00139             \textcolor{comment}{// Set the contact offset for the shape.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00140}00140             pxShape-\/>setContactOffset(\textcolor{keyword}{static\_cast<}physx::PxReal\textcolor{keyword}{>}(m\_contactGenOffset));}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00141}00141 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00142}00142             \textcolor{comment}{// Set the object type as robot geometry for collision filtering.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00143}00143             physx::PxFilterData filterData;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00144}00144             filterData.word0 = \textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(\mbox{\hyperlink{namespace_motion_planner_a389521f6122ca955f3e5f2f48487ace3a4a8d617c440e9ede7d3092416327a525}{ObjectType::RobotGeometry}});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00145}00145             pxShape-\/>setSimulationFilterData(filterData);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00146}00146 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00147}00147             \textcolor{comment}{// Set the shape and actor name.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00148}00148             \textcolor{keyword}{const} std::string shapeName = shape.\mbox{\hyperlink{class_motion_planner_1_1_shape_aa3c8b0855477f802a4dd0f3c70fae83f}{getName}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00149}00149             \textcolor{keyword}{const} \textcolor{keywordtype}{char}* shapeNameChar = shapeName.c\_str();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00150}00150             actor-\/>setName(shapeNameChar);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00151}00151             pxShape-\/>setName(shapeNameChar);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00152}00152 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00153}00153             \textcolor{comment}{// Store pointer to the original shape in the PxShape and PxActor.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00154}00154             \textcolor{comment}{// Note that we must use const\_cast here since the PhysX API only accepts a non-\/const void*.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00155}00155             \textcolor{comment}{// My internal use of the shape is read only so there is no concern.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00156}00156             \textcolor{keyword}{const} \textcolor{keywordtype}{void}* shapePointerConst = \&shape;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00157}00157             \textcolor{keywordtype}{void}* shapePointer = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(shapePointerConst);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00158}00158             actor-\/>userData = shapePointer;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00159}00159             pxShape-\/>userData = shapePointer;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00160}00160 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00161}00161             \textcolor{comment}{// Attach the shape to the actor and release.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00162}00162             actor-\/>attachShape(*pxShape);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00163}00163             pxShape-\/>release();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00164}00164 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00165}00165             \textcolor{comment}{// Add new actor to scene.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00166}00166             m\_robotGeometryActors.emplace(shapeName, actor);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00167}00167             m\_scene-\/>addActor(*actor);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00168}00168         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00169}00169         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00170}00170         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00171}00171             \textcolor{keywordflow}{throw} std::invalid\_argument(\textcolor{stringliteral}{"{}Shape must be a robot geometry shape."{}});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00172}00172         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00173}00173     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00174}00174 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00175}00175     \textcolor{keywordtype}{void} PhysicsScene::addCollisionAggregate(\textcolor{keyword}{const} CollisionAggregate\& collisionAggregate)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00176}00176     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00177}00177         \textcolor{comment}{// Vector of colliders inside the collision aggregate.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00178}00178         \textcolor{keyword}{const} std::vector<const Shape*> colliders = collisionAggregate.getColliders();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00179}00179 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00180}00180         \textcolor{comment}{// Add each collider to the scene.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00181}00181         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} Shape* collider : colliders)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00182}00182         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00183}00183             addCollider(*collider);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00184}00184         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00185}00185     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00186}00186 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00187}00187     \textcolor{keywordtype}{void} PhysicsScene::addRigidBodyChain(\textcolor{keyword}{const} RigidBodyChain\& rigidBodyChain)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00188}00188     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00189}00189         \textcolor{comment}{// For each rigid body in the chain, add the collision aggregate to the scene.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00190}00190         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} RigidBody\& rigidBody : rigidBodyChain.getRigidBodies())}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00191}00191         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00192}00192             addCollisionAggregate(rigidBody.getCollisionAggregate());}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00193}00193         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00194}00194     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00195}00195 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00196}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ab29441854f3e66856df5836e5c52fdd4}{00196}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ab29441854f3e66856df5836e5c52fdd4}{PhysicsScene::addSpatialManipulator}}(\mbox{\hyperlink{class_motion_planner_1_1_spatial_manipulator}{SpatialManipulator}}\& spatialManipulator)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00197}00197     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00198}00198         addRigidBodyChain(spatialManipulator.\mbox{\hyperlink{class_motion_planner_1_1_spatial_manipulator_a2c6575a1cac697922a54d1c6a038f3d8}{getRigidBodyChain}}());}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00199}00199         spatialManipulator.\mbox{\hyperlink{class_motion_planner_1_1_spatial_manipulator_a397ed731bbfa82e78392d0060cd93710}{setPhysicsScene}}(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00200}00200     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00201}00201 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00202}00202     \textcolor{keywordtype}{void} PhysicsScene::syncTransforms()}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00203}00203     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00204}00204         \textcolor{comment}{// For each PxActor of a collider, update the pose and target to the collider's current pose.}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00205}00205         \textcolor{keywordflow}{for} (std::pair<const std::string, physx::PxRigidDynamic*> colliderActor : m\_robotGeometryActors)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00206}00206         \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00207}00207             physx::PxRigidDynamic*\& pxActor = colliderActor.second;}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00208}00208             \textcolor{keywordflow}{if} (pxActor-\/>userData)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00209}00209             \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00210}00210                 \textcolor{keyword}{const} \mbox{\hyperlink{class_motion_planner_1_1_shape}{Shape}}* shapeActor = \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }\mbox{\hyperlink{class_motion_planner_1_1_shape}{Shape}}*\textcolor{keyword}{>}(pxActor-\/>userData);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00211}00211                 \textcolor{keyword}{const} Eigen::Matrix4d newTransform = shapeActor-\/>\mbox{\hyperlink{class_motion_planner_1_1_shape_a3b70c302b3b3171e9162a495c6722842}{getTransform}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00212}00212                 \textcolor{keyword}{const} physx::PxTransform newPxTransform = \mbox{\hyperlink{namespace_motion_planner_a838cea8f45278eb0326d5c7e528ac2f2}{eigenMatrixToPxTransform}}(newTransform);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00213}00213                 pxActor-\/>setGlobalPose(newPxTransform);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00214}00214                 pxActor-\/>setKinematicTarget(newPxTransform);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00215}00215             \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00216}00216         \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00217}00217     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00218}00218 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00219}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a3a1b0c8617ebb84b2a97ec04ad570bf1}{00219}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_a3a1b0c8617ebb84b2a97ec04ad570bf1}{PhysicsScene::addContact}}(\textcolor{keyword}{const} std::string\& linkName, \textcolor{keyword}{const} \mbox{\hyperlink{struct_motion_planner_1_1_contact_point}{ContactPoint}}\& contactPoint)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00220}00220     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00221}00221         m\_contactManager.\mbox{\hyperlink{class_motion_planner_1_1_contact_manager_afd8198fa2c961462ac1403929313ec19}{addContact}}(linkName, contactPoint);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00222}00222     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00223}00223 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00224}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ad86bc364257acd8a2a247c62273829ba}{00224}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ad86bc364257acd8a2a247c62273829ba}{PhysicsScene::setContactOffsets}}(\textcolor{keywordtype}{double} manipulatorSafetyDistance, \textcolor{keywordtype}{double} fingerSafetyDistance)}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00225}00225     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00226}00226         \textcolor{comment}{/* Not yet implemented */}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00227}00227     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00228}00228 }
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00229}\mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ae489972e3ba384b383a0b87c8022b3d7}{00229}}     \textcolor{keyword}{const} std::map<std::string, ContactPoint>\& \mbox{\hyperlink{class_motion_planner_1_1_physics_scene_ae489972e3ba384b383a0b87c8022b3d7}{PhysicsScene::generateContacts}}()}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00230}00230     \{}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00231}00231         syncTransforms();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00232}00232         m\_contactManager.\mbox{\hyperlink{class_motion_planner_1_1_contact_manager_a7f9f83cee66a0d7d53453111015840cd}{clearContacts}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00233}00233         m\_scene-\/>simulate(m\_timeStep);}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00234}00234         m\_scene-\/>fetchResults(\textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00235}00235         m\_contactManager.\mbox{\hyperlink{class_motion_planner_1_1_contact_manager_a95f2aae2315a9eba379c68a2a529de4f}{reduceContacts}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00236}00236         \textcolor{keywordflow}{return} m\_contactManager.\mbox{\hyperlink{class_motion_planner_1_1_contact_manager_a5596d0cc57907ccbb5119481d693ae0b}{getContacts}}();}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00237}00237     \}}
\DoxyCodeLine{\Hypertarget{_physics_scene_8cpp_source_l00238}00238 \}}

\end{DoxyCode}
